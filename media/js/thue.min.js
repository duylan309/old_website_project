Handlebars.registerHelper('checkboxValue', function(string , value ) {
  
  var arr_value = string && string.length ? string.split(",") : [];
  var check ='';

  for(var i=0, l=arr_value.length; i<l; i++) {
    if(value == arr_value[i]){
        return check='checked';
        break;
    }
  }

  return check;
});

Handlebars.registerHelper('checkRadioValue', function(a , value ) {
  var check ='';
    if(value == a){
        return check='checked';
    }
  return check;
});


Handlebars.registerHelper('convertString', function(string) {
  return escape(string);
});


Handlebars.registerHelper('addCommaSpace', function(string) {
  
  var newstring = string && string.length ? string.replace(/,/g, ', ') : string;
  
  return newstring;
});

$(function() {
    window.listCmpListTXT = window.listCmpListTXT || [];
    var availableTags = ["Apprentice Bartender","Area Director","Assistant Chef","Assistant General Manager","Assistant Kitchen Manager","Associate Creative Director","Baker","Bakery-Cafe Associate","Barback","Barista","Bar Manager","Bartender","Brand Manager","Bus Person","Cashier","Casual Restaurant Manager","Chef","Chef Manager","Coffee Tasting Room Assistant","Communications Manager","Cook","Culinary Services Supervisor","Culinary Trainee","Dessert Finisher","Digital Marketing Manager","Dining Room Manager","Director of Human Resources","Dishwasher","District Manager","Espresso Beverage Maker","Executive Chef","Expeditor","Field Recruiting Manager","Fine Dining Restaurant Manager","Food Runner","Front Manager","Grill Cook","Hibachi Chef","Host","Human Resources Manager","Inventory Analyst","Kitchen Manager","Kitchen Worker","Lead Cook","Line Cook","Manager, Research and Development","National Training Manager","Operations Analyst","Pantry Worker","Prep Cook","Product Manager","Regional Brand Development Manager","Regional Facilities Manager","Regional Manager","Regional Operations Specialist","Restaurant General Manager","Restaurant Manager","Server","Shift Supervisor","Sous Chef","Steward","Waiter","Waitress","Waiter/ Waitress","Bếp phó","Bếp trưởng điều hành","Chuyen viên phân tích điều hành","Chuyên viên điều hành vùng","Chuyên viên kiểm kê kho","Giám đôc khu vực","Giám đốc nhân sự","Giám sát ca","Giám sát dịch vụ ẩm thực","Nấu bếp","Người dọn dẹp","Nhân viên bếp Hibachi","Nhân viên bếp nướng","Nhân viên bếp","Nhân viên bếp","Nhân viên dọn dẹp","Nhân viên đón khách","Nhân viên hoàn thiện món tráng miệng","Nhân viên pha chế cà phê","Nhân viên phục vụ ","Nhân viên phục vụ","Nhân viên rửa chén","nhân viên sơ chế thực phẩm","Nhân viên tiếp thực","Pha chế cà phê","Pha chế rượu","Phó Giám đốc sáng tạo ","Phụ bếp","Phụ bếp","Phục vụ nam","Phục vụ nữ","Phục vụ thực tập","Quản lý bar","Quản lý bếp","Quản lý bếp","Quản lý cơ sở vùng","Quản lý đào tạo","Quản lý nhà hàng","Quản lý nhà hàng","Quản lý nhà hàng","Quản lý nhà hàng","Quản lý nhân sự","Quản lý phát triển thương hiệu vùng","Quản lý quận","Quản lý sản phẩm","Quản lý thương hiệu","Quản lý tiền sảnh","Quản lý truyền thông đa phương tiện","Quản lý truyền thông","Quản lý tuyển dụng","Quản lý vùng","Thợ làm bánh","Thu ngân","Thực tập pha chế","Tổng quản lý nhà hàng","Trợ lý pha chế","Trợ lý phòng dùng thử cà phê","Trợ lý quản lý bếp","Trợ lý quản lý cấp cao","Trưởng nhóm phụ bếp"];
    var cmpName = [];

    $('.job-title').autocomplete({
        source: availableTags
    });

    if(window.listCmpListTXT.db.length){
        availableTags = availableTags.concat(window.listCmpListTXT.db.split(','));
    }

    $("#searchbar, .filter-list .form-control[name='title'],.banner-left .form-control[name='title']").autocomplete({
       source: availableTags
    });

    $('.mobile-expand [data-button-notification]').click(function(){
        $('[data-content-notification]').toggleClass('active');
        $('.menu-expand,.search-content,[data-content-setting],[data-content-category]').removeClass('active');
        checkWebsiteScroll();
    });

    $('.mobile-expand [data-button-message]').click(function(){
        $('[data-content-message]').toggleClass('active');
        $('.menu-expand,.search-content,[data-content-setting],[data-content-category]').removeClass('active');
        checkWebsiteScroll();
    });

    $('#searchTopBtn, .filter-btn, .close-search').click(function(){
        $('.search-content,.filter-btn').toggleClass('active');
        $('[data-content-notification],.menu-expand,[data-content-setting],[data-content-category]').removeClass('active');
        checkWebsiteScroll();
    });

    $('.navigation-button,.list-menu').click(function(){
        $('.menu-expand,.navigation-button').toggleClass('active');
        $('.search-content,[data-content-notification],[data-content-setting],[data-content-category]').removeClass('active');
        checkWebsiteScroll();
    });

    $('.btn-category').click(function(){
        $('[data-content-category]').toggleClass('active');
        $('.search-content,[data-content-notification],.menu-expand,[data-content-setting]').removeClass('active');
        checkWebsiteScroll();
    });

    $('.btn-setting').click(function(){
        $('[data-content-setting]').toggleClass('active');
        $('.search-content,[data-content-notification],.menu-expand,[data-content-category]').removeClass('active');
        checkWebsiteScroll();
    });

    $('.menu-expand a').click(function(){
        $('.menu-expand,.navigation-button').toggleClass('active');
    });

    $('.filter-shortcut').click(function() {
        $('.filter-hidden').toggleClass('hidden');
        $(this).toggleClass('active');
    });


    $("[data-old-message]").last().addClass('show');

    function checkWebsiteScroll(){

        if( $(".get-action").is(".active") || $(".mobile-expand").is(".active") || $("[data-content-notification]").is(".active")){
           $('.website').not(".no-scroll").addClass('no-scroll');
        }else{
           $('.website').removeClass('no-scroll');
        }

    }

    function isMobile() {

        var check = false;

        (function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(    hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)    0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac    (er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v    )w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-    d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(    m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac(     |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(    k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-|     |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(    ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(    07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(    c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(    gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-    v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))    check = true})(navigator.userAgent||navigator.vendor||window.opera);

        return check;

    }
   
    $(window).load(function () {
        
        $('.homep .banner-home').css('background','#333');
        $('.skill-tag').tagEditor({delimiter: ',',
                                   forceLowercase: false, 
                                   removeDuplicates:true});

        $('.tag-function').click(function() {
            var current = $(this).attr('data-value');
            if(current == 1){
                $(this).attr('data-value',0).html($(this).attr('data-lang-value0'));
                $('.skill-tag').css('display','block').tagEditor('destroy');
            }else{
                $(this).attr('data-value',1).html($(this).attr('data-lang-value1'));
                $('.skill-tag').css('display','none').tagEditor({delimiter: ',',
                                   forceLowercase: false, 
                                   removeDuplicates:true});
            }
        });
        
        $("form textarea").bind("keypress", function (e) {
         if (e.keyCode == 13) {
             return true;
         }
        });

        $(document).on('click','.btn-checkbox .tx, .location-select', function(){
           $(this).closest('.form-group').removeClass('invalid');
           $(this).parent('.checkbox').toggleClass('checked').find("input").trigger("click");
        });

        $('html').on('click','[btn-upload-photo]', function() {
            $("#ImageBrowse").trigger("click");
        });

        $('.modal-signin').on('click','.checkbox', function(){
           $(this).toggleClass('checked').find("input").trigger("click");
        });

        $('.no-facebook-fanpage').click(function() {
            $('.company-create-info').toggleClass('active');
            $(this).toggleClass('hidden');
        })

        // $('[data-search-form]').on('click','.filter-category-section .checkbox input',function(){
        //     if($(this).prop('checked') == true){
        //         $(this).attr('checked',true);
        //     }else{
        //         $(this).attr('checked',false);
        //     }
        //     $('[data-search-form]').submit();
        // });

        $(".btn-employer-action").click(function() {
            $(this).closest('.employer-action-status').removeClass('employer-action1 employer-action2 employer-action3 employer-action4 employer-action5');
        });

        $('[data-request-window-loaded]').removeAttr('disabled');

        $('.load-old-messages').click(function() {
            $('[data-old-message]').addClass('active');
            $(this).addClass('hidden');
        });

        $("[data-check-all] input").click(function () {
            $(".checkbox input").prop('checked', $(this).prop("checked"));
        });

        $("[data-overflow][data-show]").click(function() {
            $(this).removeAttr('data-overflow');
        });

        // Rating
        $('.star-rating .fa').click(function() {
            $(".star-rating .fa").removeClass('fa-star').addClass('fa-star-o');
            var getStar = $(this).attr('data-star');
            for(var $i = 0;$i<=getStar;$i++){
                $(".star-rating .fa[data-star='"+$i+"']").removeClass('fa-star-o').addClass('fa-star');
            }
            $('[data-rate-star]').val(getStar);
        });

        // Not allow to write email
        $('[data-template-id="entryCmpPostJob"] textarea').change(function() {
            $(this).val( function(idx, val) {
               return val.replace(/\b(\w)+\@(\w)+\.(\w)+\b/g, "");
            });
        });

    });

    $( document ).ajaxStart(function() {
        $('button[type="submit"], input[type="submit"]').attr('disabled', 'disabled');
    });

    $( document ).ajaxStop(function() {
        $('button[type="submit"], input[type="submit"]').removeAttr('disabled');
       
        $('.add-tag').on('click', function(){
            $('.skill-tag').tagEditor('addTag', $(this).attr('tag-value'));
        });

    });

    if(!isMobile()){

        $('.banner-home,#header').scrollToFixed();
        // $(document).on('click', '.item-job a', function(e) {
        //     e.preventDefault();
        //     var $new_url = $(this).attr('href');
        //     window.history.pushState("object or string", "Title", $new_url);
        // });

    }else{

        // $( window ).scroll(function() {
        //     var top  = window.pageYOffset || document.documentElement.scrollTop;
        //     if(top == 0){
        //         $('#header').removeClass('ffixed').next('div').remove();
        //         fixedtop = 0;
        //     }else if(top > 60){
        //         var $width = $('#header').width()+10;
        //         $('#header').not('.ffixed').after('<div style="width:'+$width+'px;height:57px;position:relative;left:0;top:0"></div>').addClass('ffixed');
        //     }

        // });

        var coverBanner = $(".cover-photo");
        if(coverBanner.length){
            $(window).load(function () {
                var bannerValue = $(".cover-photo img[data-image-review], .cover-photo .image-preview .img-with-css").outerHeight();
                $(".cover-section").css({
                    height: bannerValue,
                    "max-height": bannerValue
                });
            });
        }

        $('#user-menu').click(function() {
            $(this).toggleClass('active');
        });

        var listHtmlMobile =   window.listHtmlContent ;

        if(listHtmlMobile != "undefined"){
            Object.keys(listHtmlMobile).forEach(function(key){
                $('.search-category ul').append('<li><a title="'+listHtmlMobile[key]['ti_vi']+'" href="/'+listHtmlMobile[key]['url']+'">'+listHtmlMobile[key]['ti']+'</a></li>');                    
            });
        }

        $('.ex-more-pg').click(function() {
            $(this).toggleClass('active');
        });

        $('[data-search-mobile]').bind("keypress", function (e) {
         
         if (e.keyCode == 13) {
            $(this).find('form').submit();
            return false;
         }
        });
    }

    var didScroll;
    var lastScrollTop = 0;
    var delta = 5;
    var navbarHeight = $('#header').outerHeight();

    function hasScrolled() {
        var st = $(this).scrollTop();

        if(Math.abs(lastScrollTop - st) <= delta)
            return;

        if (st > lastScrollTop && st > navbarHeight){
            $('#header').removeClass('nav-down').addClass('nav-up');
        } else {
            if(st + $(window).height() < $(document).height()) {
                $('#header').removeClass('nav-up').addClass('nav-down');
            }
        }

        lastScrollTop = st;
    }

    var images = Array("banner-background-two",
                       "banner-background-three",
                       "banner-background-four",
                       "banner-background-one");
    var imagesload = new Array()
    function preload() {
        for (i = 0; i < preload.arguments.length; i++) {
            imagesload[i] = new Image()
            imagesload[i].src = preload.arguments[i]
        }
    }

    preload(
        "/img/style/banner-home-1.jpg",
        "/img/style/banner-home-2.jpg",
        "/img/style/banner-home-3.jpg",
        "/img/style/banner-home-4.jpg"
    )

    var currimg = 0;
    function loadimg(){
        if(currimg!=0 && currimg < images.length-1){
            $('.banner-left').removeClass(images[currimg-1], 1500,'easeInQuad');
        }else if(currimg > images.length-1){
            $('.banner-left').removeClass(images[images.length-1], 1500,'easeInQuad');
            currimg=0;
        }    

        $('.banner-left').addClass(images[currimg], 1500,'easeInQuad');
        currimg++;

        setTimeout(loadimg,3000);
    }

    setTimeout(loadimg,3000);

    $('[data-toggle="popover"]').popover();

    $(document).on("change","#ImageBrowse", function(){
        var files = !!this.files ? this.files : [];
        if (!files.length || !window.FileReader) return; // no file selected, or no FileReader support
        
        if (/^image/.test( files[0].type)){ // only image file
            
            var reader = new FileReader(); // instance of the FileReader
            reader.readAsDataURL(files[0]); // read the local file
        
            reader.onloadend = function(){ // set image data as background of div
                resizebase64(this.result,'#imagePreview');
                $("[img-upload-size]").attr({"value": files[0].size});

                if(files[0].size >= 10000000){
                    $("#applywithoutsignin").attr('disabled','disabled');
                    $("#imagePreview").closest('.image-preview').addClass('error');
                    
                }else{
                    $("#applywithoutsignin").removeAttr('disabled');
                    $("#imagePreview").closest('.image-preview').removeClass('error');
                }

            }
        }
    });

    function resizebase64($source){

        var canvas = document.createElement("canvas");
        var ctx = canvas.getContext("2d");

        canvas.width = 160; 
        /* Draw */
        var image = new Image();
        image.src = $source;

        
        image.onload = function(e) {
            canvas.height = canvas.width * image.height / image.width;

            ctx.drawImage(image, 
                0, 0, image.width, image.height, 
                0, 0, canvas.width, canvas.height
            );

            var resampledImage = new Image();
            resampledImage.src = canvas.toDataURL();
            
            $("#imagePreview").attr("style", "background:url("+canvas.toDataURL()+") no-repeat");
            $("#ImageName").attr({"value": canvas.toDataURL()});

            return true;
        };

        return false;
    }
    
    $('[data-select-order]').change(function() {
        $('[data-order]').attr('value',$(this).val());
        $('[data-search-form]').submit();    
    });

});